#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

if [ $# -ne 1 ]
then
	echo "usage: $(basename $0) <name>"
	exit 1
fi

NAME=$1

echo "Sourcing ${NAME}/var"
source ${NAME}/var

echo Creating ${NAME}/tfvars
cat >${NAME}/tfvars <<EOF
# This file was automatically generated by the tf script.
# The authoritative source for this data is ${NAME}/var.
# Probably do not edit this file.

aws_access_key = "${AWS_ACCESS_KEY}"
aws_secret_key = "${AWS_SECRET_KEY}"
aws_region = "${AWS_REGION}"

rds_subnet_a_availability_zone = "${RDS_SUBNET_A_AZ}"
rds_subnet_b_availability_zone = "${RDS_SUBNET_B_AZ}"
rds_subnet_c_availability_zone = "${RDS_SUBNET_C_AZ}"
app_mapper_db_password = "${RDS_APP_MAPPER_DB_PASSWORD}"
users_db_password = "${RDS_USERS_DB_PASSWORD}"

route53_zone_name = "${R53_ZONE_NAME}"
route53_resource_name = "${R53_RESOURCE_NAME}"
route53_frontend_elb_endpoint = "${R53_FRONTEND_ELB_ENDPOINT}"
route53_frontend_elb_zone_id = "${R53_FRONTEND_ELB_ZONE_ID}"
EOF

echo Creating ${NAME}/aws.tf
cp aws.template ${NAME}/aws.tf