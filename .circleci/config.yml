version: 2
defaults: &defaults
  machine:
    docker_layer_caching: true
  working_directory: ~/weaveworks/service
jobs:
  build:
    <<: *defaults
    steps:
      - checkout
      - run: cat /etc/lsb-release
      - run: free -h
      - run: cat /proc/cpuinfo
      - run: sudo add-apt-repository ppa:webupd8team/java
      - run: echo debconf shared/accepted-oracle-license-v1-1 select true | sudo debconf-set-selections
      - run: echo debconf shared/accepted-oracle-license-v1-1 seen true | sudo debconf-set-selections
      - run: sudo apt-get update && sudo apt-get install oracle-java8-installer
      - run: echo "deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list
      - run: curl https://bazel.build/bazel-release.pub.gpg | sudo apt-key add -
      - run: sudo apt-get update && sudo apt-get install bazel
      - run: make bazel-ci-build

workflows:
  version: 2
  build:
    jobs:
      - build
